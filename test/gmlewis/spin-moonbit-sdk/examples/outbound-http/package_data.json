{
  "readme": "# Spin component in MoonBit\n\nThis example is based on this blog post: https://www.moonbitlang.com/blog/component-model\nand this GitHub example: https://github.com/moonbitlang/moonbit-docs/tree/464356567270284446244cccecd101c04e9806f8/examples/wasi-http\n\nIn one terminal window, start up the app:\n\n```shell\n$ spin build --up\n```\n\nThen in another terminal window, get the results:\n\n```shell\n$ curl -i localhost:3000/outbound-http\nHTTP/1.1 200 OK\ncontent-type: application/json\ntransfer-encoding: chunked\ndate: Fri, 16 Aug 2024 21:42:38 GMT\n\n{\"timestamp\":1723844558854,\"fact\":\"Water slows down light\"}\n```\n\nTo test the `consume` and `stream` endpoints, start up a python server in\nanother terminal window in the root directory of this repo:\n\n```shell\n$ python3 -m http.server 8080\n```\n\nThen use `curl` to test the endpoint:\n\n```shell\n$ curl -X POST http://localhost:3000/consume -d 'http/localhost:8080/LICENSE'\nOK\n\n$ curl -X POST http://localhost:3000/consume?md5sum -d 'http://localhost:8080/LICENSE'\n86d3f3a95c324c9479bd8986968f4327\n\n$ curl -X POST http://localhost:3000/consume?sha256sum -d 'http://localhost:8080/LICENSE'\nc71d239df91726fc519c6eb72d318ec65820627232b2f796219e87dcf35d0ab4\n\n$ curl -X POST http://localhost:3000/stream -d 'http://localhost:8080/LICENSE' | wc\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100 11386  100 11357  100    29  2555k   6682 --:--:-- --:--:-- --:--:-- 2779k\n     201    1581   11357\n\n$ curl -X POST http://localhost:3000/stream?md5sum -d 'http://localhost:8080/LICENSE' | wc\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100 11386  100 11357  100    29  2578k   6741 --:--:-- --:--:-- --:--:-- 2223k\n     201    1581   11357\n\n$ curl -X POST http://localhost:3000/stream?sha256sum -d 'http://localhost:8080/LICENSE' | wc\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100 11386  100 11357  100    29  1388k   3629 --:--:-- --:--:-- --:--:-- 1588k\n     201    1581   11357\n```\n\nView the `spin` stderr output:\n\n```shell\nServing http://127.0.0.1:3000\nAvailable Routes:\n  outbound-http: http://127.0.0.1:3000 (wildcard)\n\nINFO: Performing GET 'http://localhost:8080/LICENSE'\nINFO: Status code = 200\nINFO: Header['server'] = 'SimpleHTTP/0.6 Python/3.9.6'\nINFO: Header['date'] = 'Sun, 18 Aug 2024 14:02:52 GMT'\nINFO: Header['content-type'] = 'application/octet-stream'\nINFO: Header['content-length'] = '11357'\nINFO: Header['last-modified'] = 'Tue, 04 Jun 2024 20:58:42 GMT'\nINFO: Consumed 11357 bytes from 'GET http://localhost:8080/LICENSE'\n\nINFO: Performing GET 'http://localhost:8080/LICENSE'\nINFO: Status code = 200\nINFO: Header['server'] = 'SimpleHTTP/0.6 Python/3.9.6'\nINFO: Header['date'] = 'Sun, 18 Aug 2024 14:03:01 GMT'\nINFO: Header['content-type'] = 'application/octet-stream'\nINFO: Header['content-length'] = '11357'\nINFO: Header['last-modified'] = 'Tue, 04 Jun 2024 20:58:42 GMT'\nINFO: Consumed 11357 bytes from 'GET http://localhost:8080/LICENSE', md5sum = 86d3f3a95c324c9479bd8986968f4327\n\nINFO: Performing GET 'http://localhost:8080/LICENSE'\nINFO: Status code = 200\nINFO: Header['server'] = 'SimpleHTTP/0.6 Python/3.9.6'\nINFO: Header['date'] = 'Sun, 18 Aug 2024 14:03:17 GMT'\nINFO: Header['content-type'] = 'application/octet-stream'\nINFO: Header['content-length'] = '11357'\nINFO: Header['last-modified'] = 'Tue, 04 Jun 2024 20:58:42 GMT'\nINFO: Consumed 11357 bytes from 'GET http://localhost:8080/LICENSE', sha256sum = c71d239df91726fc519c6eb72d318ec65820627232b2f796219e87dcf35d0ab4\n\nINFO: Performing GET 'http://localhost:8080/LICENSE'\nINFO: Status code = 200\nINFO: Header['server'] = 'SimpleHTTP/0.6 Python/3.9.6'\nINFO: Header['date'] = 'Sun, 18 Aug 2024 14:03:35 GMT'\nINFO: Header['content-type'] = 'application/octet-stream'\nINFO: Header['content-length'] = '11357'\nINFO: Header['last-modified'] = 'Tue, 04 Jun 2024 20:58:42 GMT'\nINFO: Streamed 11357 bytes from 'GET http://localhost:8080/LICENSE'\n\nINFO: Performing GET 'http://localhost:8080/LICENSE'\nINFO: Status code = 200\nINFO: Header['server'] = 'SimpleHTTP/0.6 Python/3.9.6'\nINFO: Header['date'] = 'Sun, 18 Aug 2024 14:03:56 GMT'\nINFO: Header['content-type'] = 'application/octet-stream'\nINFO: Header['content-length'] = '11357'\nINFO: Header['last-modified'] = 'Tue, 04 Jun 2024 20:58:42 GMT'\nINFO: Streamed 11357 bytes from 'GET http://localhost:8080/LICENSE', md5sum = 86d3f3a95c324c9479bd8986968f4327\n\nINFO: Performing GET 'http://localhost:8080/LICENSE'\nINFO: Status code = 200\nINFO: Header['server'] = 'SimpleHTTP/0.6 Python/3.9.6'\nINFO: Header['date'] = 'Sun, 18 Aug 2024 14:04:04 GMT'\nINFO: Header['content-type'] = 'application/octet-stream'\nINFO: Header['content-length'] = '11357'\nINFO: Header['last-modified'] = 'Tue, 04 Jun 2024 20:58:42 GMT'\nINFO: Streamed 11357 bytes from 'GET http://localhost:8080/LICENSE', sha256sum = c71d239df91726fc519c6eb72d318ec65820627232b2f796219e87dcf35d0ab4\n```\n",
  "name": "gmlewis/spin-moonbit-sdk/examples/outbound-http",
  "traits": [],
  "types": [],
  "typealias": [],
  "values": [
    {
      "name": "cabi_realloc",
      "docstring": "",
      "signature": "fn cabi_realloc(src_offset : Int, src_size : Int, _dst_alignment : Int, dst_size : Int) -> Int",
      "loc": { "line": 2, "column": 8 }
    },
    {
      "name": "handle",
      "docstring": " `handle` handles a `GET /outbound-http` request and makes an outbound\n GET request to `url` and returns its JSON response. It also handles\n a `POST /md5sum` where the body is another URL to GET from. It will\n stream the response of that endpoint to its `response_out` and calculate\n that stream's md5sum, reporting it to stderr when the stream ends.",
      "signature": "fn handle(request : <a href=\"gmlewis/spin-moonbit-sdk/interface/imports/wasi/http/types#IncomingRequest\">@gmlewis/spin-moonbit-sdk/interface/imports/wasi/http/types.IncomingRequest</a>, response_out : <a href=\"gmlewis/spin-moonbit-sdk/interface/imports/wasi/http/types#ResponseOutparam\">@gmlewis/spin-moonbit-sdk/interface/imports/wasi/http/types.ResponseOutparam</a>) -> Unit",
      "loc": { "line": 11, "column": 8 }
    },
    {
      "name": "wasmExportHandle",
      "docstring": "",
      "signature": "fn wasmExportHandle(p0 : Int, p1 : Int) -> Unit",
      "loc": { "line": 12, "column": 8 }
    }
  ],
  "misc": []
}